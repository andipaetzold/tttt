(this["webpackJsonptttt-web"]=this["webpackJsonptttt-web"]||[]).push([[0],{47:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n.n(c),r=n(13),i=n.n(r),o=n(18),s=n(11),l=n(10),u=n(31),j=n(9),d=n(8),b=n(27),h=n.n(b),O=n(53),f=n(54),v=n(58),x=n(32),p=n(57),m=n(56),g=["Amelia","Bowie","Coco","Dan","Emma","Finn","Grace","Henry","Irene","Jack"],y="config",w=g.slice(0,6).map((function(e){return{text:e,enabled:!0,time:30}}));var k={voiceChanged:function(){return"Go faster!"},start:function(){return"Start"},15:function(e){var t=e.nextAthlete;return"".concat(t,". Get ready.")},10:function(){return"Change in 10"},5:function(){return"Five"},2:function(){return"Two"},1:function(){return"One"},0:function(e){var t=e.nextAthlete;return"Change to ".concat(t)}};function S(e,t,n){k[e]&&function(e,t){var n=new SpeechSynthesisUtterance;n.text=e,n.lang="en-US",n.voice=t,window.speechSynthesis.cancel(),window.speechSynthesis.speak(n)}(k[e](t),n)}function C(e){return Math.round(e/1e3)}var I=n(16),N=n.n(I),D=n(24),E="wakeLock"in navigator;var R=n(49),A=n(28),T=n(50),G=n(51),L=n(52),U=n(1);function z(e){var t=e.athletes,n=e.onChange;return Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)("h3",{children:"Athletes"}),t.map((function(e,c){return Object(U.jsx)(m.a.Group,{as:R.a,controlId:"athlete-".concat(c),children:Object(U.jsx)(A.a,{sm:12,children:Object(U.jsxs)(T.a,{children:[Object(U.jsx)(m.a.Control,{style:{background:!e.enabled&&"#6c757d80"},type:"text",placeholder:"Name",value:e.text,onChange:function(e){return n(t.map((function(t,n){return n===c?Object(s.a)(Object(s.a)({},t),{},{text:e.target.value}):t})))}}),Object(U.jsx)(m.a.Control,{style:{background:!e.enabled&&"#6c757d80"},type:"number",placeholder:"Time (in seconds)",min:1,value:e.time,onChange:function(e){return n(t.map((function(t,n){return n===c?Object(s.a)(Object(s.a)({},t),{},{time:+e.target.value}):t})))}}),Object(U.jsx)(T.a.Append,{children:Object(U.jsx)(G.a,{toggle:!0,children:Object(U.jsx)(L.a,{variant:"outline-secondary",type:"checkbox",name:"athlete-".concat(c,"-enabled"),checked:!e.enabled,disabled:e.enabled&&1===t.filter((function(e){return e.enabled})).length,onChange:function(e){return n(t.map((function(t,n){return n===c?Object(s.a)(Object(s.a)({},t),{},{enabled:!e.target.checked}):t})))},children:Object(U.jsx)(d.a,{icon:j.f})})})})]})})},c)}))]})}var M=n(25);function F(){return Object(U.jsxs)("footer",{className:"text-muted mt-4 mb-2 text-center",children:[Object(U.jsx)("p",{children:Object(U.jsxs)("small",{children:["Made with \u2665 for"," ",Object(U.jsx)("a",{href:"https://www.wtrl.racing",rel:"noopener noreferrer",target:"_blank",children:"WTRL"})," ","by"," ",Object(U.jsx)("a",{href:"https://zwiftpower.com/profile.php?z=1861132",rel:"noopener noreferrer",target:"_blank",children:"Andi P\xe4tzold"})]})}),Object(U.jsx)("p",{children:Object(U.jsx)("small",{children:Object(U.jsxs)("a",{href:"https://paypal.me/andipaetzold",rel:"noopener noreferrer",target:"_blank",children:[Object(U.jsx)(d.a,{icon:M.b})," Donate via PayPal"]})})}),Object(U.jsx)("p",{children:Object(U.jsx)("small",{children:Object(U.jsxs)("a",{href:"https://github.com/andipaetzold/tttt",rel:"noopener noreferrer",target:"_blank",children:[Object(U.jsx)(d.a,{icon:M.a})," GitHub"]})})})]})}var J=n(55);function B(){return Object(U.jsx)(J.a,{bg:"light",className:"mb-2",children:Object(U.jsxs)(J.a.Brand,{className:"mx-auto",children:[Object(U.jsx)(d.a,{icon:j.b})," Team Time Trial Timer"," ",Object(U.jsx)(d.a,{icon:j.b})]})})}function P(e){var t=e.voices,n=e.voice,c=e.onChange;return Object(U.jsxs)(m.a.Group,{controlId:"voice",children:[Object(U.jsx)(m.a.Label,{children:"Voice"}),Object(U.jsx)(m.a.Control,{as:"select",onChange:function(e){var n=e.target.value,a=t.find((function(e){return e.voiceURI===n}));a&&(S("voiceChanged",{},a),c(a))},value:null===n||void 0===n?void 0:n.voiceURI,disabled:0===t.length,children:t.length>0?t.map((function(e){return Object(U.jsx)("option",{value:e.voiceURI,children:e.name},e.voiceURI)})):Object(U.jsx)("option",{children:"Default"},"default")}),Object(U.jsxs)(m.a.Text,{children:["If the voice output does not work anymore, click"," ",Object(U.jsx)(x.a,{style:{padding:0,fontSize:"100%",border:"none"},variant:"link",onClick:function(){c(void 0),setTimeout((function(){window.location.reload()}),0)},children:"here"})," ","to reset the app and keep the default voice."]})]})}var V=function(){try{var e=localStorage.getItem(y),t=JSON.parse(e);return{athletes:t.athletes||w,speechEnabled:t.speechEnabled,startDelay:t.startDelay,voice:t.voice}}catch(n){return{athletes:w,speechEnabled:false,startDelay:0}}}();function _(){var e=Object(c.useState)("stopped"),t=Object(l.a)(e,2),n=t[0],a=t[1];!function(e){var t=Object(c.useRef)(null);Object(c.useEffect)((function(){if(E&&e){var n=function(){var e=Object(D.a)(N.a.mark((function e(){var n;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=t.current)||void 0===n?void 0:n.release();case 2:t.current=null;case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c=function(){var e=Object(D.a)(N.a.mark((function e(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("visible"===document.visibilityState){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,n();case 5:return e.next=7,navigator.wakeLock.request("screen");case 7:t.current=e.sent,e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}();return c(),document.addEventListener("visibilitychange",c),function(){n(),document.removeEventListener("visibilitychange",c)}}}),[e])}("running"===n||"paused"===n);var r=Object(c.useState)(V.startDelay),i=Object(l.a)(r,2),b=i[0],w=i[1],k=Object(c.useState)(V.speechEnabled),I=Object(l.a)(k,2),R=I[0],A=I[1],T=Object(c.useState)(V.athletes),G=Object(l.a)(T,2),L=G[0],M=G[1],J=function(e){return void 0===e?"":L[e].text||"Athlete ".concat(e+1)},_=function(){var e=Object(c.useState)([]),t=Object(l.a)(e,2),n=t[0],a=t[1],r=function(){a(window.speechSynthesis.getVoices())};return Object(c.useEffect)((function(){if("undefined"!==typeof window.speechSynthesis)return r(),window.speechSynthesis.onvoiceschanged=r,function(){return window.speechSynthesis.onvoiceschanged=void 0}}),[]),n.filter((function(e){return e.lang.startsWith("en-")}))}(),W=Object(c.useState)(V.voice),H=Object(l.a)(W,2),q=H[0],X=H[1],K=_.find((function(e){return e.voiceURI===q})),Q=Object(c.useState)(0),Y=Object(l.a)(Q,2),Z=Y[0],$=Y[1],ee=Object(c.useState)(void 0),te=Object(l.a)(ee,2),ne=te[0],ce=te[1];Object(c.useEffect)((function(){var e;e={athletes:L,startDelay:b,speechEnabled:R,voice:q},localStorage.setItem(y,JSON.stringify(e))}),[L,b,R,q]);var ae=Object(c.useMemo)((function(){var e=L.map((function(e,t){return Object(s.a)(Object(s.a)({},e),{},{index:t})}));return void 0===ne?e.find((function(e){return e.enabled})).index:[].concat(Object(o.a)(e.slice(ne+1)),Object(o.a)(e)).filter((function(e){return e.enabled}))[0].index}),[ne,L]),re=Object(c.useRef)(),ie=Object(c.useRef)(),oe=Object(c.useRef)(),se=function(e){R&&S(e,{nextAthlete:J(ae)},K)},le=function(){ce(ae),$(L[ae].time);var e=Date.now();re.current=e,"paused"===n&&(oe.current=e)};h()((function(){if("running"===n){var e=void 0===ne?b:L[ne].time,t=Date.now(),c=C(t-re.current);c!==C(ie.current-re.current)&&(c>=e?(se(void 0===ne?"start":0),le()):(se(e-c),$(Math.max(e-c,0)))),ie.current=t}}),500);return Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(B,{}),Object(U.jsxs)(O.a,{children:[Object(U.jsx)(f.a,{className:"mb-2",children:"stopped"!==n?Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)("h1",{className:"text-center display-2",children:void 0===ne?"Wait":J(ne)}),Object(U.jsxs)("h2",{className:"text-center display-5",children:[Object(U.jsx)(d.a,{icon:j.a})," ",J(ae)]}),Object(U.jsxs)("h3",{className:"text-center display-6",children:[Object(U.jsx)(d.a,{icon:u.a})," ",Z,"s"]}),Object(U.jsx)(v.a,{style:{transform:"scaleX(-1)",background:"white"},now:Z,max:void 0===ne?b:L[ne].time}),Object(U.jsxs)("div",{className:"mt-4 text-center",children:[Object(U.jsxs)(x.a,{variant:"danger",className:"mr-1",onClick:function(){a("stopped")},children:[Object(U.jsx)(d.a,{icon:j.g})," Stop"]}),"paused"===n?Object(U.jsxs)(x.a,{variant:"info",className:"mr-1",onClick:function(){a("running"),re.current=Date.now()-(oe.current-re.current)},children:[Object(U.jsx)(d.a,{icon:j.e})," Resume"]}):Object(U.jsxs)(x.a,{variant:"info",className:"mr-1",onClick:function(){a("paused"),oe.current=Date.now()},children:[Object(U.jsx)(d.a,{icon:j.d})," Pause"]}),Object(U.jsxs)(x.a,{variant:"warning",onClick:le,children:[Object(U.jsx)(d.a,{icon:j.c})," Skip"]})]})]}):Object(U.jsx)("div",{className:"text-center",children:Object(U.jsxs)(x.a,{variant:"primary",onClick:function(){var e=Date.now();ie.current=e,re.current=e,$(b>0?b:L[0].time),ce(b>0?void 0:ae),a("running")},size:"lg",children:[Object(U.jsx)(d.a,{icon:j.e})," Start"]})})}),Object(U.jsx)(p.a,{className:"mb-2",children:Object(U.jsxs)(p.a.Body,{children:[Object(U.jsx)(z,{athletes:L,onChange:M}),Object(U.jsx)("h3",{children:"Settings"}),Object(U.jsxs)(m.a.Group,{controlId:"startDelay",children:[Object(U.jsx)(m.a.Label,{children:"Start Delay (in seconds)"}),Object(U.jsx)(m.a.Control,{type:"number",value:b,onChange:function(e){return w(+e.target.value)},min:0})]}),Object(U.jsxs)(m.a.Group,{controlId:"athleteCount",children:[Object(U.jsx)(m.a.Label,{children:"Athlete Count"}),Object(U.jsx)(m.a.Control,{type:"number",value:L.length,onChange:function(e){var t=Math.max(1,Math.min(g.length,+e.target.value)),n=Object(o.a)(new Array(t).keys()).map((function(e){var t,n,c,a,r,i;return{text:null!==(t=null===(n=L[e])||void 0===n?void 0:n.text)&&void 0!==t?t:g[e],time:null!==(c=null===(a=L[e])||void 0===a?void 0:a.time)&&void 0!==c?c:30,enabled:null===(r=null===(i=L[e])||void 0===i?void 0:i.enabled)||void 0===r||r}}));M(n)},min:1,max:g.length})]}),Object(U.jsxs)(m.a.Group,{controlId:"speechEnabled",children:[Object(U.jsx)(m.a.Check,{type:"checkbox",label:"Voice Output",checked:R,onChange:function(e){return A(e.target.checked)}}),Object(U.jsx)(m.a.Text,{children:"Voice Output is not supported on iOS"})]}),Object(U.jsx)(P,{voices:_,voice:K,onChange:function(e){return X(null===e||void 0===e?void 0:e.voiceURI)}})]})}),Object(U.jsx)(F,{})]})]})}n(46);i.a.render(Object(U.jsx)(a.a.StrictMode,{children:Object(U.jsx)(_,{})}),document.getElementById("root"))}},[[47,1,2]]]);
//# sourceMappingURL=main.36306660.chunk.js.map